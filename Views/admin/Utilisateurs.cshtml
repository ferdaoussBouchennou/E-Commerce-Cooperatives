@model List<E_Commerce_Cooperatives.Models.ViewModels.UserListViewModel>
@using E_Commerce_Cooperatives.Models.ViewModels
@{
    ViewBag.Title = "Gestion des Utilisateurs";
    Layout = "~/Views/Admin/_AdminLayout.cshtml";
    
    var users = Model ?? new List<UserListViewModel>();
    var searchTerm = ViewBag.SearchTerm as string ?? "";
    var statusFilter = ViewBag.StatusFilter as string ?? "all";
    var currentPage = ViewBag.CurrentPage as int? ?? 1;
    var pageSize = ViewBag.PageSize as int? ?? 20;
    var totalCount = ViewBag.TotalCount as int? ?? 0;
    var totalPages = ViewBag.TotalPages as int? ?? 1;
}

<div class="admin-page">
    <div class="admin-page-header">
        <h1 class="admin-page-title">Gestion des Utilisateurs</h1>
        <p class="admin-page-subtitle">Gérez les comptes clients</p>
    </div>

    <!-- Search and Filters -->
    <div class="admin-filters">
        <div class="filters-row">
            <div class="search-large">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="#305C7D" viewBox="0 0 16 16" class="search-icon">
                    <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z" />
                </svg>
                <input type="text" id="searchInput" class="search-input-large" placeholder="Rechercher par nom, prénom ou email..." value="@searchTerm" />
            </div>
            <div class="status-filter-wrapper">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#305C7D" viewBox="0 0 16 16" class="filter-icon">
                    <path d="M1.5 1.5A.5.5 0 0 1 2 1h12a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-.128.334L10 8.692V13.5a.5.5 0 0 1-.342.474l-3 1A.5.5 0 0 1 6 14.5V8.692L1.628 3.834A.5.5 0 0 1 1.5 3.5v-2z"/>
                </svg>
                <select id="statusFilter" class="status-filter">
                    <option value="all" @(statusFilter == "all" ? "selected" : "")>Tous</option>
                    <option value="active" @(statusFilter == "active" ? "selected" : "")>Actifs</option>
                    <option value="inactive" @(statusFilter == "inactive" ? "selected" : "")>Inactifs</option>
                </select>
            </div>
            <button type="button" class="btn-add-user" onclick="openAddUserModal()">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 16 16">
                    <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
                </svg>
                Ajouter
            </button>
        </div>
    </div>

    <!-- Stat cards -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-value">@((int)(ViewBag.CardTotalUsers ?? 0))</div>
            <div class="stat-label">Total utilisateurs</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">@((int)(ViewBag.CardActiveUsers ?? 0))</div>
            <div class="stat-label">Actifs</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">@((int)(ViewBag.CardThisMonth ?? 0))</div>
            <div class="stat-label">Ce mois</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">@((int)(ViewBag.CardTotalOrders ?? 0))</div>
            <div class="stat-label">Total commandes</div>
        </div>
    </div>

    <!-- Users Table -->
    <div class="table-card">
        <div class="table-responsive">
            <table class="admin-table users-table">
                <thead>
                    <tr>
                        <th>Utilisateur</th>
                        <th>Contact</th>
                        <th>Ville</th>
                        <th>Commandes</th>
                        <th>Total dépensé</th>
                        <th>Statut</th>
                        <th>Détails</th>
                    </tr>
                </thead>
                <tbody>
                    @if (users.Any())
                    {
                        foreach (var user in users)
                        {
                            var initials = $"{(string.IsNullOrEmpty(user.Prenom) ? "" : user.Prenom.Substring(0,1))}{(string.IsNullOrEmpty(user.Nom) ? "" : user.Nom.Substring(0,1))}";
                            <tr>
                                <td>
                                    <div class="user-cell">
                                        <div class="avatar-circle">@initials.ToUpper()</div>
                                        <div>
                                            <div class="user-name">@user.Prenom @user.Nom</div>
                                            <div class="user-meta">Inscrit le @user.DateCreation.ToString("yyyy-MM-dd")</div>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <div class="contact-cell">
                                        <div class="contact-row">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="#305C7D" viewBox="0 0 16 16">
                                                <path d="M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V4zm2-1a1 1 0 0 0-1 1v.217l7 4.2 7-4.2V4a1 1 0 0 0-1-1H2zm13 2.383-4.708 2.825L15 10.118V5.383zM14.247 11 9.2 8.118 8 8.882 6.8 8.118 1.753 11H14.247zM1 10.118l4.708-2.91L1 5.383v4.735z"/>
                                            </svg>
                                            <span>@user.Email</span>
                                        </div>
                                        <div class="contact-row">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="#305C7D" viewBox="0 0 16 16">
                                                <path d="M3.654 1.328a.678.678 0 0 1 1.015-.063l2.29 2.29a.678.678 0 0 1-.063 1.015L6.21 5.22a.678.678 0 0 0-.154.738c.386.93 1.05 1.793 1.97 2.713.92.92 1.783 1.584 2.713 1.97a.678.678 0 0 0 .738-.154l.65-.65a.678.678 0 0 1 1.015-.063l2.29 2.29a.678.678 0 0 1-.063 1.015l-1.3 1.3c-.285.285-.69.39-1.066.274-1.517-.47-3.366-1.58-5.348-3.562C5.324 9.02 4.214 7.171 3.744 5.654c-.115-.376-.01-.781.274-1.066l1.3-1.3z"/>
                                            </svg>
                                            <span>@(string.IsNullOrEmpty(user.Telephone) ? "-" : user.Telephone)</span>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <div class="location-cell">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="#305C7D" viewBox="0 0 16 16">
                                            <path d="M8 16s6-5.686 6-10A6 6 0 0 0 2 6c0 4.314 6 10 6 10zm0-7a3 3 0 1 1 0-6 3 3 0 0 1 0 6z"/>
                                        </svg>
                                        <span>@(string.IsNullOrEmpty(user.Ville) ? "N/A" : user.Ville)</span>
                                    </div>
                                </td>
                                <td class="text-center">@user.OrderCount</td>
                                <td class="text-center">@user.TotalDepense.ToString("N0") MAD</td>
                                <td>
                                    <label class="toggle-switch">
                                        <input type="checkbox" class="status-toggle" 
                                               data-user-id="@user.ClientId" 
                                               @(user.EstActif ? "checked" : "") />
                                        <span class="toggle-slider"></span>
                                        <span class="toggle-label">@(user.EstActif ? "Actif" : "Inactif")</span>
                                    </label>
                                </td>
                                <td>
                                    <div class="action-buttons">
                                        <button type="button" class="btn-view-profile" onclick="openUserDetailsModal(@user.ClientId)" title="Voir le profil">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                                <path d="M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8zM1.173 8a13.133 13.133 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5c2.12 0 3.879 1.168 5.168 2.457A13.133 13.133 0 0 1 14.828 8c-.058.087-.122.183-.195.288-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5c-2.12 0-3.879-1.168-5.168-2.457A13.134 13.134 0 0 1 1.172 8z"/>
                                                <path d="M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5zM4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0z"/>
                                            </svg>
                                        </button>
                                        <button type="button" class="btn-edit-user" onclick="openEditUserModalDirect(@user.ClientId)" title="Modifier">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                                <path d="M12.854.146a.5.5 0 0 0-.707 0L10.5 1.793 14.207 5.5l1.647-1.646a.5.5 0 0 0 0-.708l-3-3zm.646 6.061L9.793 2.5 3.293 9H3.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.207l6.5-6.5zm-7.468 7.468A.5.5 0 0 1 6 13.5V13h-.5a.5.5 0 0 1-.5-.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.5-.5V10h-.5a.499.499 0 0 1-.175-.032l-.179.178a.5.5 0 0 0-.11.168l-2 5a.5.5 0 0 0 .65.65l5-2a.5.5 0 0 0 .168-.11l.178-.178z"/>
                                            </svg>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        }
                    }
                    else
                    {
                        <tr>
                            <td colspan="7" class="text-center">Aucun utilisateur trouvé</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>

    <!-- Pagination -->
    @if (totalPages > 1)
    {
        <div class="pagination-wrapper">
            <nav class="pagination">
                @if (currentPage > 1)
                {
                    <a href="@Url.Action("Utilisateurs", "Admin", new { searchTerm = searchTerm, statusFilter = statusFilter, page = currentPage - 1 })" class="page-link">Précédent</a>
                }
                
                @for (int i = Math.Max(1, currentPage - 2); i <= Math.Min(totalPages, currentPage + 2); i++)
                {
                    <a href="@Url.Action("Utilisateurs", "Admin", new { searchTerm = searchTerm, statusFilter = statusFilter, page = i })" 
                       class="page-link @(i == currentPage ? "active" : "")">@i</a>
                }
                
                @if (currentPage < totalPages)
                {
                    <a href="@Url.Action("Utilisateurs", "Admin", new { searchTerm = searchTerm, statusFilter = statusFilter, page = currentPage + 1 })" class="page-link">Suivant</a>
                }
            </nav>
        </div>
    }
</div>

<!-- Add User Modal -->
<div id="addUserModal" class="modal-overlay">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Ajouter un nouveau client</h3>
            <button type="button" class="modal-close" onclick="closeAddUserModal()">&times;</button>
        </div>
        <form id="addUserForm" method="post" action="@Url.Action("AddUser", "Admin")">
            @Html.AntiForgeryToken()
            <div class="modal-body">
                <div class="form-group">
                    <label>Prénom *</label>
                    <input type="text" name="Prenom" class="form-control" required />
                </div>
                <div class="form-group">
                    <label>Nom *</label>
                    <input type="text" name="Nom" class="form-control" required />
                </div>
                <div class="form-group">
                    <label>Email *</label>
                    <input type="email" name="Email" class="form-control" required />
                </div>
                <div class="form-group">
                    <label>Téléphone</label>
                    <input type="text" name="Telephone" class="form-control" />
                </div>
                <div class="form-group">
                    <label>Mot de passe *</label>
                    <input type="password" name="MotDePasse" class="form-control" required minlength="6" />
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-cancel" onclick="closeAddUserModal()">Annuler</button>
                <button type="submit" class="btn-submit">Ajouter</button>
            </div>
        </form>
    </div>
</div>

<!-- User Details Modal -->
<div id="userDetailsModal" class="modal-overlay">
    <div class="modal-content modal-large">
        <div class="modal-header">
            <h3>Détails de l'utilisateur</h3>
            <button type="button" class="modal-close" onclick="closeUserDetailsModal()">&times;</button>
        </div>
        <div class="modal-body" id="userDetailsContent">
            <div style="text-align: center; padding: 40px;">
                <div class="spinner-border" role="status">
                    <span class="sr-only">Chargement...</span>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn-cancel" onclick="closeUserDetailsModal()">Fermer</button>
        </div>
    </div>
</div>

<!-- Edit User Modal -->
<div id="editUserModal" class="modal-overlay">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Modifier le client</h3>
            <button type="button" class="modal-close" onclick="closeEditUserModal()">&times;</button>
        </div>
        <form id="editUserForm" method="post" action="@Url.Action("UpdateUser", "Admin")">
            @Html.AntiForgeryToken()
            <input type="hidden" name="ClientId" id="editClientId" />
            <div class="modal-body">
                <div class="form-group">
                    <label>Prénom *</label>
                    <input type="text" name="Prenom" id="editPrenom" class="form-control" required />
                </div>
                <div class="form-group">
                    <label>Nom *</label>
                    <input type="text" name="Nom" id="editNom" class="form-control" required />
                </div>
                <div class="form-group">
                    <label>Email *</label>
                    <input type="email" name="Email" id="editEmail" class="form-control" required />
                </div>
                <div class="form-group">
                    <label>Téléphone</label>
                    <input type="text" name="Telephone" id="editTelephone" class="form-control" />
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-cancel" onclick="closeEditUserModal()">Annuler</button>
                <button type="submit" class="btn-submit">Enregistrer</button>
            </div>
        </form>
    </div>
</div>

@section scripts {
    @Html.AntiForgeryToken()
    <script>
        let searchTimeout;
        let isSearching = false;
        
        // Improved real-time search - only triggers after user stops typing
        document.getElementById('searchInput').addEventListener('input', function() {
            if (isSearching) return;
            
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(function() {
                isSearching = true;
                performSearch();
                setTimeout(function() { isSearching = false; }, 1000);
            }, 1000); // Wait 1 second after user stops typing
        });

        // Allow Enter key to search immediately
        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                clearTimeout(searchTimeout);
                performSearch();
            }
        });

        document.getElementById('statusFilter').addEventListener('change', function() {
            performSearch();
        });

        function performSearch() {
            const searchTerm = document.getElementById('searchInput').value;
            const statusFilter = document.getElementById('statusFilter').value;
            const url = '@Url.Action("Utilisateurs", "Admin")' + '?searchTerm=' + encodeURIComponent(searchTerm) + '&statusFilter=' + encodeURIComponent(statusFilter);
            window.location.href = url;
        }

        // Toggle status
        document.querySelectorAll('.status-toggle').forEach(toggle => {
            toggle.addEventListener('change', function() {
                const userId = this.getAttribute('data-user-id');
                const isActive = this.checked;
                const label = this.closest('.toggle-switch').querySelector('.toggle-label');
                
                let confirmMessage = isActive 
                    ? 'Êtes-vous sûr de vouloir activer ce compte ?' 
                    : 'Êtes-vous sûr de vouloir désactiver ce compte ? \n\nATTENTION : Cela annulera également toutes les commandes en cours de cet utilisateur.';

                if (confirm(confirmMessage)) {
                    const token = document.querySelector('input[name="__RequestVerificationToken"]').value;
                    const formData = new FormData();
                    formData.append('userId', userId);
                    formData.append('isActive', isActive);
                    formData.append('__RequestVerificationToken', token);
                    
                    fetch('@Url.Action("ToggleUserStatus", "Admin")', {
                        method: 'POST',
                        body: formData
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            label.textContent = isActive ? 'Actif' : 'Inactif';
                            if (data.message && data.message.includes('annulée')) {
                                alert(data.message); // Show cancellation details
                                location.reload(); // Refresh to update order counts/stats if needed
                            }
                        } else {
                            this.checked = !isActive;
                            alert('Erreur: ' + data.message);
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        this.checked = !isActive;
                        alert('Une erreur est survenue');
                    });
                } else {
                    this.checked = !isActive;
                }
            });
        });

        // Modal functions
        function openAddUserModal() {
            const addModal = document.getElementById('addUserModal');
            if (addModal) {
                addModal.style.display = 'flex';
            }
        }

        function closeAddUserModal() {
            const addModal = document.getElementById('addUserModal');
            const addForm = document.getElementById('addUserForm');
            if (addModal) {
                addModal.style.display = 'none';
            }
            if (addForm) {
                addForm.reset();
            }
        }

        // Close modal on outside click
        const addUserModal = document.getElementById('addUserModal');
        if (addUserModal) {
            addUserModal.addEventListener('click', function(e) {
                if (e.target === this) {
                    closeAddUserModal();
                }
            });
        }

        // User Details Modal functions
        function openUserDetailsModal(userId) {
            const detailsModal = document.getElementById('userDetailsModal');
            const detailsContent = document.getElementById('userDetailsContent');
            
            if (!detailsModal || !detailsContent) {
                console.error('Modal elements not found');
                alert('Erreur: Éléments du modal introuvables');
                return;
            }
            
            detailsModal.style.display = 'flex';
            detailsContent.innerHTML = '<div style="text-align: center; padding: 40px;"><div class="spinner-border" role="status"><span class="sr-only">Chargement...</span></div></div>';

            var url = '@Url.Content("~/Admin/GetUserDetailsJson")?id=' + userId;
            console.log('Fetching URL:', url);
            
            fetch(url)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('HTTP error! status: ' + response.status);
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('Response data:', data);
                    if (data.success && data.user) {
                        const user = data.user;
                        
                        // Store current user ID for edit modal
                        window.currentEditUserId = user.ClientId;
                        
                        // Helper function to format dates safely
                        function formatDate(dateString) {
                            if (!dateString) return null;
                            try {
                                // Try to parse as ISO string or timestamp
                                let date;
                                if (typeof dateString === 'string') {
                                    // Remove timezone info if present
                                    const cleanDate = dateString.replace(/\/Date\((\d+)\)\//, '$1');
                                    if (cleanDate.match(/^\d+$/)) {
                                        date = new Date(parseInt(cleanDate));
                                    } else {
                                        date = new Date(cleanDate);
                                    }
                                } else {
                                    date = new Date(dateString);
                                }
                                
                                if (isNaN(date.getTime())) {
                                    return null;
                                }
                                return date.toLocaleDateString('fr-FR', { day: '2-digit', month: '2-digit', year: 'numeric' });
                            } catch (e) {
                                console.error('Date parsing error:', e);
                                return null;
                            }
                        }
                        
                        function formatDateTime(dateString) {
                            if (!dateString) return 'Jamais';
                            try {
                                let date;
                                if (typeof dateString === 'string') {
                                    const cleanDate = dateString.replace(/\/Date\((\d+)\)\//, '$1');
                                    if (cleanDate.match(/^\d+$/)) {
                                        date = new Date(parseInt(cleanDate));
                                    } else {
                                        date = new Date(cleanDate);
                                    }
                                } else {
                                    date = new Date(dateString);
                                }
                                
                                if (isNaN(date.getTime())) {
                                    return 'Jamais';
                                }
                                return date.toLocaleDateString('fr-FR', { day: '2-digit', month: '2-digit', year: 'numeric', hour: '2-digit', minute: '2-digit' });
                            } catch (e) {
                                console.error('DateTime parsing error:', e);
                                return 'Jamais';
                            }
                        }
                        
                        const dateNaissance = formatDate(user.DateNaissance);
                        const dateCreation = formatDateTime(user.DateCreation);
                        const derniereConnexion = formatDateTime(user.DerniereConnexion);
                        const initials = `${(user.Prenom ? user.Prenom.charAt(0) : '')}${(user.Nom ? user.Nom.charAt(0) : '')}`.toUpperCase();
                        
                        const detailsContent = document.getElementById('userDetailsContent');
                        if (!detailsContent) {
                            console.error('userDetailsContent element not found');
                            alert('Erreur: Élément de contenu introuvable');
                            return;
                        }
                        
                        detailsContent.innerHTML = `
                            <div class="user-details-container">
                                <div class="user-details-header">
                                    <div class="user-avatar-large">${initials}</div>
                                    <div class="user-header-info">
                                        <h4>${user.Prenom} ${user.Nom}</h4>
                                        <span class="status-badge-modal ${user.EstActif ? 'status-active-modal' : 'status-inactive-modal'}">
                                            ${user.EstActif ? 'Actif' : 'Inactif'}
                                        </span>
                                    </div>
                                </div>
                                
                                <div class="user-details-grid">
                                    <div class="details-section">
                                        <h5 class="section-title">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 16 16">
                                                <path d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0zm4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4zm-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10c-2.29 0-3.516.68-4.168 1.332-.678.678-.83 1.418-.832 1.664h10z"/>
                                            </svg>
                                            Informations personnelles
                                        </h5>
                                        <div class="info-grid">
                                            <div class="info-item">
                                                <label>Email</label>
                                                <div class="info-value">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 16 16">
                                                        <path d="M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V4zm2-1a1 1 0 0 0-1 1v.217l7 4.2 7-4.2V4a1 1 0 0 0-1-1H2zm13 2.383-4.708 2.825L15 10.118V5.383zM14.247 11 9.2 8.118 8 8.882 6.8 8.118 1.753 11H14.247zM1 10.118l4.708-2.91L1 5.383v4.735z"/>
                                                    </svg>
                                                    <span>${user.Email}</span>
                                                </div>
                                            </div>
                                            <div class="info-item">
                                                <label>Téléphone</label>
                                                <div class="info-value">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 16 16">
                                                        <path d="M3.654 1.328a.678.678 0 0 1 1.015-.063l2.29 2.29a.678.678 0 0 1-.063 1.015L6.21 5.22a.678.678 0 0 0-.154.738c.386.93 1.05 1.793 1.97 2.713.92.92 1.783 1.584 2.713 1.97a.678.678 0 0 0 .738-.154l.65-.65a.678.678 0 0 1 1.015-.063l2.29 2.29a.678.678 0 0 1-.063 1.015l-1.3 1.3c-.285.285-.69.39-1.066.274-1.517-.47-3.366-1.58-5.348-3.562C5.324 9.02 4.214 7.171 3.744 5.654c-.115-.376-.01-.781.274-1.066l1.3-1.3z"/>
                                                    </svg>
                                                    <span>${user.Telephone || '-'}</span>
                                                </div>
                                            </div>
                                            ${dateNaissance ? `
                                            <div class="info-item">
                                                <label>Date de naissance</label>
                                                <div class="info-value">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 16 16">
                                                        <path d="M11 6.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1z"/>
                                                        <path d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5zM1 4v10a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4H1z"/>
                                                    </svg>
                                                    <span>${dateNaissance}</span>
                                                </div>
                                            </div>
                                            ` : ''}
                                            <div class="info-item">
                                                <label>Date d'inscription</label>
                                                <div class="info-value">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 16 16">
                                                        <path d="M8 3.5a.5.5 0 0 0-1 0V9a.5.5 0 0 0 .252.434l3.5 2a.5.5 0 0 0 .496-.868L8 8.71V3.5z"/>
                                                        <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm7-8A7 7 0 1 1 1 8a7 7 0 0 1 14 0z"/>
                                                    </svg>
                                                    <span>${dateCreation}</span>
                                                </div>
                                            </div>
                                            <div class="info-item">
                                                <label>Dernière connexion</label>
                                                <div class="info-value">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 16 16">
                                                        <path d="M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2v1z"/>
                                                        <path d="M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466z"/>
                                                    </svg>
                                                    <span>${derniereConnexion}</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="stats-section">
                                        <h5 class="section-title">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 16 16">
                                                <path d="M0 2a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2zm15 2h-4v3h4V4zm0 4h-4v3h4V8zm0 4h-4v3h3a1 1 0 0 0 1-1v-2zm-5 3v-3H6v3h4zm-5 0v-3H1v2a1 1 0 0 0 1 1h3zm-4-4h4V8H1v3zm0-4h4V4H1v3zm5-3v3h4V4H6zm4 4H6v3h4V8z"/>
                                            </svg>
                                            Statistiques
                                        </h5>
                                        <div class="stats-grid">
                                            <div class="stat-card">
                                                <div class="stat-icon stat-icon-orders">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 16 16">
                                                        <path d="M0 1.5A.5.5 0 0 1 .5 1H2a.5.5 0 0 1 .485.379L2.89 3H14.5a.5.5 0 0 1 .491.592l-1.5 8A.5.5 0 0 1 13 12H4a.5.5 0 0 1-.491-.408L2.01 3.607 1.61 2H.5a.5.5 0 0 1-.5-.5zM3.102 4l1.313 7h8.17l1.313-7H3.102zM5 14a1 1 0 1 0 0 2 1 1 0 0 0 0-2zm-2 1a2 2 0 1 1 4 0 2 2 0 0 1-4 0zm9-1a1 1 0 1 0 0 2 1 1 0 0 0 0-2zm-2 1a2 2 0 1 1 4 0 2 2 0 0 1-4 0z"/>
                                                    </svg>
                                                </div>
                                                <div class="stat-content">
                                                    <div class="stat-label">Commandes</div>
                                                    <div class="stat-value-large">${user.OrderCount}</div>
                                                </div>
                                            </div>
                                            <div class="stat-card">
                                                <div class="stat-icon stat-icon-money">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 16 16">
                                                        <path d="M11 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h6zM5 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H5z"/>
                                                        <path d="M8.5 6a.5.5 0 0 0-1 0v7a.5.5 0 0 0 1 0V6zM7.5 7.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 0 1H8a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 0 1H8a.5.5 0 0 1-.5-.5z"/>
                                                    </svg>
                                                </div>
                                                <div class="stat-content">
                                                    <div class="stat-label">Total dépensé</div>
                                                    <div class="stat-value-large">${parseFloat(user.TotalSpent).toFixed(2)} MAD</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `;
                    } else {
                        const errorMsg = data.message || 'Erreur lors du chargement des détails';
                        console.error('Error response:', data);
                        const detailsContent = document.getElementById('userDetailsContent');
                        if (detailsContent) {
                            detailsContent.innerHTML = '<div class="alert alert-danger">' + errorMsg + '</div>';
                        }
                    }
                })
                .catch(error => {
                    console.error('Fetch error:', error);
                    console.error('Error details:', error.stack);
                    const detailsContent = document.getElementById('userDetailsContent');
                    if (detailsContent) {
                        detailsContent.innerHTML = '<div class="alert alert-danger">Erreur lors du chargement des détails: ' + (error.message || 'Erreur inconnue') + '</div>';
                    }
                });
        }

        function closeUserDetailsModal() {
            const detailsModal = document.getElementById('userDetailsModal');
            if (detailsModal) {
                detailsModal.style.display = 'none';
            }
        }

        // Close user details modal on outside click
        const userDetailsModal = document.getElementById('userDetailsModal');
        if (userDetailsModal) {
            userDetailsModal.addEventListener('click', function(e) {
                if (e.target === this) {
                    closeUserDetailsModal();
                }
            });
        }

        // Edit User Modal functions
        function openEditUserModalDirect(userId) {
            const editModal = document.getElementById('editUserModal');
            const detailsModal = document.getElementById('userDetailsModal');
            
            if (!editModal) {
                console.error('Edit modal not found');
                alert('Erreur: Modal de modification introuvable');
                return;
            }
            
            // Close details modal if open
            if (detailsModal && detailsModal.style.display === 'flex') {
                closeUserDetailsModal();
            }
            
            // Show edit modal immediately
            editModal.style.display = 'flex';
            
            // Clear form first
            const editClientId = document.getElementById('editClientId');
            const editPrenom = document.getElementById('editPrenom');
            const editNom = document.getElementById('editNom');
            const editEmail = document.getElementById('editEmail');
            const editTelephone = document.getElementById('editTelephone');
            
            if (editClientId) editClientId.value = '';
            if (editPrenom) editPrenom.value = '';
            if (editNom) editNom.value = '';
            if (editEmail) editEmail.value = '';
            if (editTelephone) editTelephone.value = '';
            
            // Load user data
            fetch('@Url.Content("~/Admin/GetUserDetailsJson")?id=' + userId)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('HTTP error! status: ' + response.status);
                    }
                    return response.json();
                })
                .then(data => {
                    if (data.success && data.user) {
                        const user = data.user;
                        const editClientId = document.getElementById('editClientId');
                        const editPrenom = document.getElementById('editPrenom');
                        const editNom = document.getElementById('editNom');
                        const editEmail = document.getElementById('editEmail');
                        const editTelephone = document.getElementById('editTelephone');
                        
                        if (editClientId) editClientId.value = user.ClientId;
                        if (editPrenom) editPrenom.value = user.Prenom || '';
                        if (editNom) editNom.value = user.Nom || '';
                        if (editEmail) editEmail.value = user.Email || '';
                        if (editTelephone) editTelephone.value = user.Telephone || '';
                    } else {
                        alert('Erreur lors du chargement des données');
                        closeEditUserModal();
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Erreur lors du chargement des données: ' + error.message);
                    closeEditUserModal();
                });
        }

        function closeEditUserModal() {
            const editModal = document.getElementById('editUserModal');
            const editForm = document.getElementById('editUserForm');
            
            if (editModal) {
                editModal.style.display = 'none';
            }
            if (editForm) {
                editForm.reset();
            }
        }

        // Initialize event listeners when DOM is ready
        function initializeEditModalListeners() {
            const editModal = document.getElementById('editUserModal');
            const editForm = document.getElementById('editUserForm');
            
            if (editModal) {
                // Close edit modal on outside click
                editModal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        closeEditUserModal();
                    }
                });
            }
            
            if (editForm) {
                // Handle edit form submission
                editForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const submitBtn = this.querySelector('button[type="submit"]');
                    if (!submitBtn) {
                        console.error('Submit button not found');
                        return;
                    }
                    
                    const originalText = submitBtn.textContent;
                    submitBtn.disabled = true;
                    submitBtn.textContent = 'Enregistrement...';
                    
                    const formData = new FormData(this);
                    const tokenInput = this.querySelector('input[name="__RequestVerificationToken"]');
                    if (!tokenInput) {
                        alert('Erreur: Token de sécurité introuvable. Veuillez recharger la page.');
                        submitBtn.disabled = false;
                        submitBtn.textContent = originalText;
                        return;
                    }
                    // Le token est déjà dans formData car il fait partie du formulaire
                    
                    fetch('@Url.Content("~/Admin/UpdateUser")', {
                        method: 'POST',
                        body: formData,
                        headers: {
                            'X-Requested-With': 'XMLHttpRequest'
                        }
                    })
                    .then(response => {
                        return response.text().then(text => {
                            if (!response.ok) {
                                let errorMessage = 'Erreur HTTP ' + response.status;
                                try {
                                    const json = JSON.parse(text);
                                    errorMessage = json.message || errorMessage;
                                } catch (e) {
                                    errorMessage = text.substring(0, 200);
                                }
                                throw new Error(errorMessage);
                            }
                            return JSON.parse(text);
                        });
                    })
                    .then(data => {
                        if (data.success) {
                            alert('Client modifié avec succès!');
                            closeEditUserModal();
                            location.reload();
                        } else {
                            alert('Erreur: ' + (data.message || 'Une erreur est survenue'));
                            submitBtn.disabled = false;
                            submitBtn.textContent = originalText;
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert('Une erreur est survenue: ' + error.message);
                        submitBtn.disabled = false;
                        submitBtn.textContent = originalText;
                    });
                });
            }
        }

        // Initialize listeners when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeEditModalListeners);
        } else {
            initializeEditModalListeners();
        }

        // Handle form submission
        document.getElementById('addUserForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const submitBtn = this.querySelector('button[type="submit"]');
            const originalText = submitBtn.textContent;
            submitBtn.disabled = true;
            submitBtn.textContent = 'Ajout en cours...';
            
            // Get the anti-forgery token from the form or from the page
            let tokenInput = this.querySelector('input[name="__RequestVerificationToken"]');
            if (!tokenInput) {
                // Try to get it from the page
                tokenInput = document.querySelector('input[name="__RequestVerificationToken"]');
            }
            
            if (!tokenInput) {
                alert('Erreur: Token de sécurité introuvable. Veuillez recharger la page.');
                submitBtn.disabled = false;
                submitBtn.textContent = originalText;
                return;
            }
            
            const formData = new FormData(this);
            
            // Ensure token is included
            if (!formData.has('__RequestVerificationToken')) {
                formData.append('__RequestVerificationToken', tokenInput.value);
            }
            
            // Debug: log form data
            console.log('Form data keys:', Array.from(formData.keys()));
            console.log('Token value:', tokenInput.value ? 'Present' : 'Missing');
            
            fetch('@Url.Action("AddUser", "Admin")', {
                method: 'POST',
                body: formData,
                headers: {
                    'X-Requested-With': 'XMLHttpRequest'
                }
            })
            .then(response => {
                console.log('Response status:', response.status);
                console.log('Response ok:', response.ok);
                
                // Get response text first
                return response.text().then(text => {
                    console.log('Response text:', text.substring(0, 500));
                    
                    // Check if response is ok
                    if (!response.ok) {
                        let errorMessage = 'Erreur HTTP ' + response.status;
                        try {
                            const json = JSON.parse(text);
                            errorMessage = json.message || errorMessage;
                        } catch (e) {
                            // If not JSON, check if it's HTML error page
                            if (text.includes('<html') || text.includes('<!DOCTYPE')) {
                                errorMessage = 'Erreur serveur. Vérifiez les logs pour plus de détails.';
                            } else if (text.length > 0) {
                                errorMessage = text.substring(0, 200);
                            } else {
                                errorMessage = 'Réponse vide du serveur';
                            }
                        }
                        throw new Error(errorMessage);
                    }
                    
                    // Try to parse as JSON
                    try {
                        return JSON.parse(text);
                    } catch (e) {
                        console.error('Failed to parse JSON:', text);
                        throw new Error('Réponse invalide du serveur. Réponse reçue: ' + text.substring(0, 100));
                    }
                });
            })
            .then(data => {
                console.log('Parsed data:', data);
                if (data && data.success) {
                    alert('Client ajouté avec succès!');
                    closeAddUserModal();
                    location.reload();
                } else {
                    alert('Erreur: ' + (data && data.message ? data.message : 'Une erreur est survenue'));
                    submitBtn.disabled = false;
                    submitBtn.textContent = originalText;
                }
            })
            .catch(error => {
                console.error('Error:', error);
                console.error('Error details:', error.stack);
                alert('Une erreur est survenue: ' + (error.message || 'Erreur inconnue'));
                submitBtn.disabled = false;
                submitBtn.textContent = originalText;
            });
        });
    </script>
}

<style>
    .admin-filters {
        margin-bottom: 20px;
    }

    .filters-row {
        display: flex;
        gap: 12px;
        align-items: center;
        flex-wrap: wrap;
    }

    .search-large {
        position: relative;
        flex: 1;
        min-width: 300px;
    }

    .search-input-large {
        width: 100%;
        padding: 12px 16px 12px 40px;
        border-radius: 10px;
        border: 1px solid #e4e4e4;
        background: #f9f6f0;
        font-size: 15px;
        transition: border-color 0.3s;
    }

    .search-input-large:focus {
        outline: none;
        border-color: #305C7D;
        background: white;
    }

    .search-icon {
        position: absolute;
        left: 12px;
        top: 50%;
        transform: translateY(-50%);
        pointer-events: none;
    }

    .status-filter-wrapper {
        position: relative;
        display: flex;
        align-items: center;
    }

    .filter-icon {
        position: absolute;
        left: 12px;
        z-index: 1;
        pointer-events: none;
    }

    .status-filter {
        padding: 12px 16px 12px 40px;
        border-radius: 10px;
        border: 1px solid #e4e4e4;
        background: white;
        min-width: 140px;
        cursor: pointer;
        appearance: none;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%23305C7D' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 12px center;
        padding-right: 35px;
    }

    .status-filter:focus {
        outline: none;
        border-color: #305C7D;
    }

    .btn-add-user {
        padding: 12px 20px;
        background: #305C7D;
        color: white;
        border: none;
        border-radius: 10px;
        font-weight: 600;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 8px;
        transition: background 0.3s;
        white-space: nowrap;
    }

    .btn-add-user:hover {
        background: #244a66;
    }

    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 14px;
        margin-bottom: 18px;
    }

    .stat-card {
        background: #fff;
        border-radius: 14px;
        padding: 18px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.06);
        transition: transform 0.2s, box-shadow 0.2s;
    }

    .stat-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .stat-value {
        font-size: 28px;
        font-weight: 800;
        color: #2a4d6c;
        line-height: 1.1;
    }

    .stat-label {
        color: #6c7a85;
        margin-top: 4px;
        font-size: 14px;
    }

    .table-card {
        background: white;
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }

    .users-table {
        width: 100%;
        border-collapse: collapse;
    }

    .users-table th {
        color: #7a8a99;
        font-weight: 600;
        padding: 16px 12px;
        text-align: left;
        border-bottom: 2px solid #e9ecef;
        font-size: 13px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .users-table td {
        padding: 16px 12px;
        border-bottom: 1px solid #f0f0f0;
        vertical-align: middle;
    }

    .users-table tbody tr:hover {
        background: #f8f9fa;
    }

    .user-cell {
        display: flex;
        gap: 12px;
        align-items: center;
    }

    .avatar-circle {
        width: 44px;
        height: 44px;
        border-radius: 50%;
        background: linear-gradient(135deg, #E8DCC2 0%, #d4c4a8 100%);
        color: #305C7D;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
        font-size: 14px;
        flex-shrink: 0;
    }

    .user-name {
        font-weight: 700;
        color: #2f4f63;
        font-size: 15px;
    }

    .user-meta {
        font-size: 12px;
        color: #8a98a6;
        margin-top: 2px;
    }

    .contact-cell {
        display: flex;
        flex-direction: column;
        gap: 6px;
    }

    .contact-row {
        display: flex;
        align-items: center;
        gap: 6px;
        color: #2f4f63;
        font-size: 14px;
    }

    .location-cell {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        color: #2f4f63;
        font-size: 14px;
    }

    .text-center {
        text-align: center;
    }

    .toggle-switch {
        position: relative;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        cursor: pointer;
    }

    .status-toggle {
        position: absolute;
        opacity: 0;
        width: 0;
        height: 0;
    }

    .toggle-slider {
        position: relative;
        width: 48px;
        height: 24px;
        background-color: #ccc;
        border-radius: 24px;
        transition: background-color 0.3s;
    }

    .toggle-slider:before {
        content: "";
        position: absolute;
        width: 18px;
        height: 18px;
        border-radius: 50%;
        background-color: white;
        top: 3px;
        left: 3px;
        transition: transform 0.3s;
        box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .status-toggle:checked + .toggle-slider {
        background-color: #7D8453;
    }

    .status-toggle:checked + .toggle-slider:before {
        transform: translateX(24px);
    }

    .toggle-label {
        font-weight: 600;
        font-size: 13px;
        color: #2f4f63;
        min-width: 50px;
    }

    .action-buttons {
        display: flex;
        gap: 8px;
        align-items: center;
        justify-content: center;
    }

    .btn-view-profile, .btn-edit-user {
        background: #305C7D;
        color: white;
        border: none;
        padding: 8px 12px;
        border-radius: 6px;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s;
        width: 36px;
        height: 36px;
    }

    .btn-view-profile:hover {
        background: #244a66;
        transform: scale(1.05);
    }

    .btn-edit-user {
        background: #7D8453;
    }

    .btn-edit-user:hover {
        background: #6a7147;
        transform: scale(1.05);
    }

    .btn-view-profile svg, .btn-edit-user svg {
        width: 16px;
        height: 16px;
    }

    .btn-details {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 8px 14px;
        background: #f0f0f0;
        color: #305C7D;
        text-decoration: none;
        border-radius: 8px;
        font-weight: 600;
        font-size: 13px;
        transition: all 0.3s;
    }

    .btn-details:hover {
        background: #305C7D;
        color: white;
        text-decoration: none;
    }

    /* Modal Styles */
    .modal-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.5);
        z-index: 1000;
        align-items: center;
        justify-content: center;
    }

    .modal-content {
        background: white;
        border-radius: 12px;
        width: 90%;
        max-width: 500px;
        max-height: 90vh;
        overflow-y: auto;
        box-shadow: 0 10px 40px rgba(0,0,0,0.2);
    }

    .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px 24px;
        border-bottom: 1px solid #e9ecef;
    }

    .modal-header h3 {
        margin: 0;
        color: #305C7D;
        font-size: 20px;
    }

    .modal-close {
        background: none;
        border: none;
        font-size: 28px;
        color: #6c757d;
        cursor: pointer;
        padding: 0;
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        line-height: 1;
    }

    .modal-close:hover {
        color: #305C7D;
    }

    .modal-body {
        padding: 24px;
    }

    .form-group {
        margin-bottom: 20px;
    }

    .form-group label {
        display: block;
        margin-bottom: 8px;
        color: #305C7D;
        font-weight: 600;
        font-size: 14px;
    }

    .form-control {
        width: 100%;
        padding: 10px 12px;
        border: 1px solid #e4e4e4;
        border-radius: 8px;
        font-size: 14px;
        box-sizing: border-box;
    }

    .form-control:focus {
        outline: none;
        border-color: #305C7D;
    }

    .modal-footer {
        padding: 20px 24px;
        border-top: 1px solid #e9ecef;
        display: flex;
        justify-content: flex-end;
        gap: 12px;
    }

    .btn-cancel {
        padding: 10px 20px;
        background: #f0f0f0;
        color: #305C7D;
        border: none;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: background 0.3s;
    }

    .btn-cancel:hover {
        background: #e0e0e0;
    }

    .btn-submit {
        padding: 10px 20px;
        background: #305C7D;
        color: white;
        border: none;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: background 0.3s;
    }

    .btn-submit:hover {
        background: #244a66;
    }

    .pagination-wrapper {
        margin-top: 20px;
        display: flex;
        justify-content: center;
    }

    .pagination {
        display: flex;
        gap: 5px;
    }

    .page-link {
        padding: 8px 12px;
        border: 1px solid #ddd;
        background: white;
        color: #305C7D;
        text-decoration: none;
        border-radius: 4px;
        transition: all 0.3s;
    }

    .page-link:hover {
        background: #f5f5f5;
    }

    .page-link.active {
        background: #305C7D;
        color: white;
        border-color: #305C7D;
    }

    /* User Details Modal Styles */
    .modal-large {
        max-width: 800px;
        width: 90%;
    }

    .user-details-container {
        padding: 0;
    }

    .user-details-header {
        display: flex;
        align-items: center;
        gap: 20px;
        padding: 25px;
        background: linear-gradient(135deg, #305C7D 0%, #4C7089 100%);
        border-radius: 12px 12px 0 0;
        margin: -24px -24px 24px -24px;
    }

    .user-avatar-large {
        width: 90px;
        height: 90px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.2);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 36px;
        font-weight: bold;
        border: 3px solid rgba(255, 255, 255, 0.3);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    .user-header-info {
        flex: 1;
    }

    .user-header-info h4 {
        margin: 0 0 8px 0;
        color: white;
        font-size: 26px;
        font-weight: 600;
    }

    .status-badge-modal {
        display: inline-block;
        padding: 6px 14px;
        border-radius: 20px;
        font-size: 13px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .status-active-modal {
        background: rgba(125, 132, 83, 0.9);
        color: white;
    }

    .status-inactive-modal {
        background: rgba(192, 108, 80, 0.9);
        color: white;
    }

    .user-details-grid {
        display: grid;
        gap: 24px;
    }

    .details-section, .stats-section {
        background: #f9f9f9;
        border-radius: 12px;
        padding: 20px;
    }

    .section-title {
        display: flex;
        align-items: center;
        gap: 10px;
        color: #305C7D;
        font-size: 18px;
        font-weight: 600;
        margin: 0 0 20px 0;
        padding-bottom: 12px;
        border-bottom: 2px solid #e0e0e0;
    }

    .section-title svg {
        color: #305C7D;
    }

    .info-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 16px;
    }

    .info-item {
        background: white;
        padding: 16px;
        border-radius: 8px;
        border: 1px solid #e8e8e8;
        transition: all 0.3s;
    }

    .info-item:hover {
        border-color: #305C7D;
        box-shadow: 0 2px 8px rgba(48, 92, 125, 0.1);
    }

    .info-item label {
        display: block;
        font-size: 12px;
        color: #888;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 8px;
        font-weight: 600;
    }

    .info-value {
        display: flex;
        align-items: center;
        gap: 10px;
        color: #333;
        font-size: 15px;
        font-weight: 500;
    }

    .info-value svg {
        color: #305C7D;
        flex-shrink: 0;
        width: 18px;
        height: 18px;
        padding: 6px;
        background: rgba(48, 92, 125, 0.1);
        border-radius: 6px;
        transition: all 0.3s;
    }

    .info-item:hover .info-value svg {
        background: rgba(48, 92, 125, 0.15);
        transform: scale(1.1);
    }

    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 16px;
    }

    .stat-card {
        background: white;
        padding: 20px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        gap: 16px;
        border: 1px solid #e8e8e8;
        transition: all 0.3s;
    }

    .stat-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(48, 92, 125, 0.15);
        border-color: #305C7D;
    }

    .stat-icon {
        width: 56px;
        height: 56px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
    }

    .stat-icon-orders {
        background: linear-gradient(135deg, #305C7D 0%, #4C7089 100%);
        color: white;
    }

    .stat-icon-money {
        background: linear-gradient(135deg, #7D8453 0%, #9BA66F 100%);
        color: white;
    }

    .stat-content {
        flex: 1;
    }

    .stat-label {
        font-size: 13px;
        color: #888;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 4px;
        font-weight: 600;
    }

    .stat-value-large {
        font-size: 24px;
        font-weight: 700;
        color: #305C7D;
    }

    .spinner-border {
        display: inline-block;
        width: 2rem;
        height: 2rem;
        vertical-align: text-bottom;
        border: 0.25em solid currentColor;
        border-right-color: transparent;
        border-radius: 50%;
        animation: spinner-border 0.75s linear infinite;
        color: #305C7D;
    }

    @@keyframes spinner-border {
        to { transform: rotate(360deg); }
    }

    .alert {
        padding: 16px;
        border-radius: 8px;
        margin: 16px 0;
    }

    .alert-danger {
        background: #fee;
        color: #c33;
        border: 1px solid #fcc;
    }

    /* Action Buttons Styles */
    .action-buttons {
        display: flex;
        gap: 8px;
        align-items: center;
        justify-content: center;
    }

    .btn-view-profile, .btn-edit-user {
        background: #305C7D;
        color: white;
        border: none;
        padding: 8px 12px;
        border-radius: 6px;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s;
        width: 36px;
        height: 36px;
    }

    .btn-view-profile:hover {
        background: #244a66;
        transform: scale(1.05);
    }

    .btn-edit-user {
        background: #7D8453;
    }

    .btn-edit-user:hover {
        background: #6a7147;
        transform: scale(1.05);
    }

    .btn-view-profile svg, .btn-edit-user svg {
        width: 16px;
        height: 16px;
    }
</style>
