@model List<E_Commerce_Cooperatives.Models.ModeLivraison>
@{
    ViewBag.Title = "Gestion de la Livraison";
    Layout = "~/Views/Admin/_AdminLayout.cshtml";
    
    var stats = ViewBag.Stats as Dictionary<string, object> ?? new Dictionary<string, object>();
}

<div class="admin-page">
    <div class="admin-page-header">
        <h1 class="admin-page-title">Gestion de la Livraison</h1>
        <p class="admin-page-subtitle">Configurez les modes et zones de livraison</p>
    </div>

    <!-- Stats Cards -->
    <div class="stats-cards">
        <div class="stat-card">
            <div class="stat-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M20 8h-3V4H3c-1.1 0-2 .9-2 2v11h2c0 1.66 1.34 3 3 3s3-1.34 3-3h6c0 1.66 1.34 3 3 3s3-1.34 3-3h2v-5l-3-4zM6 18.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zm13.5-9l1.96 2.5H17V9.5h2.5zm-1.5 9c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"/>
                </svg>
            </div>
            <div>
                <div class="stat-value">@(stats.ContainsKey("TotalModes") ? stats["TotalModes"] : 0)</div>
                <div class="stat-label">Modes de livraison</div>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M8 16s6-5.686 6-10A6 6 0 0 0 2 6c0 4.314 6 10 6 10zm0-7a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/>
                </svg>
            </div>
            <div>
                <div class="stat-value">7</div>
                <div class="stat-label">Zones couvertes</div>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 16 16">
                    <path d="M8 3.5a.5.5 0 0 0-1 0V9a.5.5 0 0 0 .252.434l3.5 2a.5.5 0 0 0 .496-.868L8 8.71V3.5z"/>
                    <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm7-8A7 7 0 1 1 1 8a7 7 0 0 1 14 0z"/>
                </svg>
            </div>
            <div>
                <div class="stat-value">@(stats.ContainsKey("LivraisonsMois") ? stats["LivraisonsMois"] : 0)</div>
                <div class="stat-label">Livraisons ce mois</div>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 16 16">
                    <path d="M4 10.781c.148 1.667 1.513 2.85 3.591 3.003V15h1.043v-1.216c2.27-.179 3.678-1.438 3.678-3.3 0-1.59-.947-2.51-2.956-3.028l-.722-.187V3.467c1.122.11 1.879.714 2.07 1.616h1.47c-.166-1.6-1.54-2.748-3.54-2.875V1H7.591v1.233c-1.939.23-3.27 1.472-3.27 3.156 0 1.454.966 2.483 2.661 2.917l.61.162v4.031c-1.149-.17-1.94-.8-2.131-1.718H4zm3.391-3.836c-1.043-.263-1.6-.825-1.6-1.616 0-.944.704-1.641 1.8-1.828v3.495l-.2-.05zm1.591 1.872c1.287.323 1.852.859 1.852 1.769 0 1.097-.826 1.828-2.2 1.939V8.73l.348.086z"/>
                </svg>
            </div>
            <div>
                <div class="stat-value">@(stats.ContainsKey("TarifMoyen") ? ((decimal)stats["TarifMoyen"]).ToString("0") : "0") MAD</div>
                <div class="stat-label">Tarif moyen</div>
            </div>
        </div>
    </div>

    <!-- Modes de livraison Section -->
    <div class="livraison-section">
        <div class="section-header">
            <h2 class="section-title">Modes de livraison</h2>
            <button class="btn btn-primary" onclick="openCreateModal()">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                    <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
                </svg>
                Ajouter
            </button>
        </div>

        <div class="modes-livraison-grid">
            @foreach (var mode in Model)
            {
                <div class="mode-card">
                    <div class="mode-card-actions">
                        <button class="btn-icon btn-icon-edit-mode" onclick="openEditModal(@mode.ModeLivraisonId)" title="Modifier">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                            </svg>
                        </button>
                        <button class="btn-icon btn-icon-delete-mode" onclick="deleteMode(@mode.ModeLivraisonId)" title="Supprimer">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
                                <path d="M3 6h18"/>
                                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                                <line x1="10" y1="11" x2="10" y2="17"/>
                                <line x1="14" y1="11" x2="14" y2="17"/>
                            </svg>
                        </button>
                    </div>
                    <div class="mode-card-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M20 8h-3V4H3c-1.1 0-2 .9-2 2v11h2c0 1.66 1.34 3 3 3s3-1.34 3-3h6c0 1.66 1.34 3 3 3s3-1.34 3-3h2v-5l-3-4zM6 18.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zm13.5-9l1.96 2.5H17V9.5h2.5zm-1.5 9c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"/>
                        </svg>
                    </div>
                    <h3 class="mode-card-title">@mode.Nom</h3>
                    <p class="mode-card-description">@(mode.Description ?? "")</p>
                    <div class="mode-card-details">
                        <div class="mode-detail-item">
                            <span class="mode-detail-label">Tarif de livraison</span>
                            <span class="mode-detail-value">@mode.Tarif.ToString("0") MAD</span>
                        </div>
                        <div class="mode-detail-item">
                            <span class="mode-detail-label">Délai de livraison</span>
                            <span class="mode-detail-delai">@(mode.DelaiEstime ?? "Non spécifié")</span>
                        </div>
                    </div>
                    @if (!mode.EstActif)
                    {
                        <div style="margin-top: 12px;">
                            <span class="badge badge-inactive">Inactif</span>
                        </div>
                    }
                    @if (!mode.EstActif)
                    {
                        <span class="badge badge-inactive">Inactif</span>
                    }
                </div>
            }
        </div>
    </div>

    <!-- Zones de livraison Section -->
    <div class="livraison-section" style="margin-top: 32px; width: 100%; max-width: 100%;">
        <div class="section-header">
            <h2 class="section-title">Zones de livraison</h2>
            <button class="btn btn-primary" onclick="openCreateZoneModal()">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                    <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
                </svg>
                Ajouter
            </button>
        </div>

        <div class="zones-livraison-table-container">
            <table class="zones-livraison-table">
                <thead>
                    <tr>
                        <th>Zone / Ville</th>
                        <th>Supplément</th>
                        <th>Délai estimé</th>
                        <th>Statut</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @{
                        var zones = ViewBag.Zones as List<E_Commerce_Cooperatives.Models.ZoneLivraison> ?? new List<E_Commerce_Cooperatives.Models.ZoneLivraison>();
                    }
                    @if (zones.Any())
                    {
                        foreach (var zone in zones)
                        {
                            <tr>
                                <td>
                                    <div class="zone-ville-cell">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16" class="zone-icon">
                                            <path fill-rule="evenodd" d="M8 16s6-5.686 6-10A6 6 0 0 0 2 6c0 4.314 6 10 6 10zm0-7a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/>
                                        </svg>
                                        <span>@zone.ZoneVille</span>
                                    </div>
                                </td>
                                <td>
                                    @if (zone.Supplement == 0)
                                    {
                                        <span class="badge badge-gratuit">Gratuit</span>
                                    }
                                    else
                                    {
                                        <span class="zone-supplement">+@zone.Supplement.ToString("0") MAD</span>
                                    }
                                </td>
                                <td>
                                    <span class="zone-delai">@zone.DelaiEstime</span>
                                </td>
                                <td>
                                    @if (zone.EstActif)
                                    {
                                        <span class="badge badge-active">Active</span>
                                    }
                                    else
                                    {
                                        <span class="badge badge-inactive">Inactive</span>
                                    }
                                </td>
                                <td>
                                    <div class="zone-actions">
                                        <button class="btn-icon-edit" onclick="openEditZoneModal(@zone.ZoneLivraisonId)" title="Modifier">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
                                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                                            </svg>
                                        </button>
                                        <button class="btn-icon-delete" onclick="deleteZone(@zone.ZoneLivraisonId)" title="Supprimer">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
                                                <path d="M3 6h18"/>
                                                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                                                <line x1="10" y1="11" x2="10" y2="17"/>
                                                <line x1="14" y1="11" x2="14" y2="17"/>
                                            </svg>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        }
                    }
                    else
                    {
                        <tr>
                            <td colspan="5" style="text-align: center; padding: 32px; color: var(--text-muted);">
                                Aucune zone de livraison configurée
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>

        @{
            var zonesPaged = ViewBag.ZonesPaged as E_Commerce_Cooperatives.Models.PagedResult<E_Commerce_Cooperatives.Models.ZoneLivraison>;
            var currentPage = ViewBag.CurrentPage as int? ?? 1;
        }
        @if (zonesPaged != null && zonesPaged.TotalPages > 1)
        {
            <div class="pagination-container">
                <div class="pagination-info">
                    Affichage de @((currentPage - 1) * 5 + 1) à @(System.Math.Min(currentPage * 5, zonesPaged.TotalCount)) sur @zonesPaged.TotalCount zones
                </div>
                <div class="pagination">
                    @if (zonesPaged.HasPreviousPage)
                    {
                        <a href="@Url.Action("Livraison", "Admin", new { page = currentPage - 1 })" class="pagination-btn">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                <path fill-rule="evenodd" d="M11.354 1.646a.5.5 0 0 1 0 .708L5.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0z"/>
                            </svg>
                            Précédent
                        </a>
                    }
                    else
                    {
                        <span class="pagination-btn pagination-btn-disabled">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                <path fill-rule="evenodd" d="M11.354 1.646a.5.5 0 0 1 0 .708L5.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0z"/>
                            </svg>
                            Précédent
                        </span>
                    }

                    @for (int i = 1; i <= zonesPaged.TotalPages; i++)
                    {
                        if (i == currentPage)
                        {
                            <span class="pagination-page pagination-page-active">@i</span>
                        }
                        else if (i == 1 || i == zonesPaged.TotalPages || (i >= currentPage - 1 && i <= currentPage + 1))
                        {
                            <a href="@Url.Action("Livraison", "Admin", new { page = i })" class="pagination-page">@i</a>
                        }
                        else if (i == currentPage - 2 || i == currentPage + 2)
                        {
                            <span class="pagination-ellipsis">...</span>
                        }
                    }

                    @if (zonesPaged.HasNextPage)
                    {
                        <a href="@Url.Action("Livraison", "Admin", new { page = currentPage + 1 })" class="pagination-btn">
                            Suivant
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                <path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z"/>
                            </svg>
                        </a>
                    }
                    else
                    {
                        <span class="pagination-btn pagination-btn-disabled">
                            Suivant
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                <path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z"/>
                            </svg>
                        </span>
                    }
                </div>
            </div>
        }
    </div>
</div>

<!-- Modal Create/Edit Zone -->
<div id="zoneModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="zoneModalTitle">Ajouter une zone de livraison</h3>
            <button class="modal-close" onclick="closeZoneModal()">&times;</button>
        </div>
        <form id="zoneForm" onsubmit="saveZone(event)">
            <input type="hidden" id="ZoneLivraisonId" name="ZoneLivraisonId" />
            <div class="form-group">
                <label for="ZoneVille">Zone / Ville *</label>
                <input type="text" id="ZoneVille" name="ZoneVille" class="form-control" required />
            </div>
            <div class="form-group">
                <label for="Supplement">Supplément (MAD) *</label>
                <input type="number" id="Supplement" name="Supplement" class="form-control" step="0.01" min="0" value="0" required />
                <small style="color: var(--text-muted);">Mettez 0 pour "Gratuit"</small>
            </div>
            <div class="form-group">
                <label for="DelaiEstimeZone">Délai estimé *</label>
                <input type="text" id="DelaiEstimeZone" name="DelaiEstime" class="form-control" placeholder="Ex: 1-2 jours" required />
            </div>
            <div class="form-group">
                <label>
                    <input type="checkbox" id="EstActifZone" name="EstActif" checked />
                    Actif
                </label>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeZoneModal()">Annuler</button>
                <button type="submit" class="btn btn-primary">Enregistrer</button>
            </div>
        </form>
    </div>
</div>

<!-- Modal Create/Edit -->
<div id="modeModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="modalTitle">Ajouter un mode de livraison</h3>
            <button class="modal-close" onclick="closeModal()">&times;</button>
        </div>
        <form id="modeForm" onsubmit="saveMode(event)">
            <input type="hidden" id="ModeLivraisonId" name="ModeLivraisonId" />
            <div class="form-group">
                <label for="Nom">Nom *</label>
                <input type="text" id="Nom" name="Nom" class="form-control" required />
            </div>
            <div class="form-group">
                <label for="Description">Description</label>
                <textarea id="Description" name="Description" class="form-control" rows="3"></textarea>
            </div>
            <div class="form-group">
                <label for="Tarif">Tarif (MAD) *</label>
                <input type="number" id="Tarif" name="Tarif" class="form-control" step="0.01" min="0" required />
            </div>
            <div class="form-group">
                <label for="DelaiEstime">Délai estimé *</label>
                <input type="text" id="DelaiEstime" name="DelaiEstime" class="form-control" placeholder="Ex: 3-5 jours ouvrables" required />
            </div>
            <div class="form-group">
                <label>
                    <input type="checkbox" id="EstActif" name="EstActif" checked />
                    Actif
                </label>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal()">Annuler</button>
                <button type="submit" class="btn btn-primary">Enregistrer</button>
            </div>
        </form>
    </div>
</div>

@section scripts {
    <script>
        function openCreateModal() {
            document.getElementById('modalTitle').textContent = 'Ajouter un mode de livraison';
            document.getElementById('modeForm').reset();
            document.getElementById('ModeLivraisonId').value = '';
            document.getElementById('EstActif').checked = true;
            document.getElementById('modeModal').style.display = 'block';
        }

        function openEditModal(id) {
            document.getElementById('modalTitle').textContent = 'Modifier le mode de livraison';
            document.getElementById('modeForm').reset();
            
            // Charger les données du mode
            fetch('@Url.Action("GetModeLivraison", "Admin")?id=' + id)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        document.getElementById('ModeLivraisonId').value = data.mode.ModeLivraisonId;
                        document.getElementById('Nom').value = data.mode.Nom;
                        document.getElementById('Description').value = data.mode.Description || '';
                        document.getElementById('Tarif').value = data.mode.Tarif;
                        document.getElementById('DelaiEstime').value = data.mode.DelaiEstime || '';
                        document.getElementById('EstActif').checked = data.mode.EstActif;
                        document.getElementById('modeModal').style.display = 'block';
                    } else {
                        alert('Erreur: ' + data.message);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Erreur lors du chargement des données');
                });
        }

        function closeModal() {
            document.getElementById('modeModal').style.display = 'none';
        }

        function saveMode(event) {
            event.preventDefault();
            
            const form = document.getElementById('modeForm');
            const formData = new FormData(form);
            
            // Utiliser set pour remplacer/s'assurer que EstActif est bien défini
            formData.set('EstActif', document.getElementById('EstActif').checked ? 'true' : 'false');

            const isEdit = formData.get('ModeLivraisonId') !== '';
            const url = isEdit ? '@Url.Action("UpdateModeLivraison", "Admin")' : '@Url.Action("CreateModeLivraison", "Admin")';
            
            fetch(url, {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(result => {
                if (result.success) {
                    alert(result.message);
                    location.reload();
                } else {
                    alert('Erreur: ' + result.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Erreur lors de l\'enregistrement');
            });
        }

        function deleteMode(id) {
            if (confirm('Êtes-vous sûr de vouloir supprimer ce mode de livraison ?')) {
                fetch('@Url.Action("DeleteModeLivraison", "Admin")?id=' + id, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                })
                .then(response => response.json())
                .then(result => {
                    if (result.success) {
                        alert(result.message);
                        location.reload();
                    } else {
                        alert('Erreur: ' + result.message);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Erreur lors de la suppression');
                });
            }
        }

        // Fermer la modal en cliquant en dehors
        window.onclick = function(event) {
            const modal = document.getElementById('modeModal');
            if (event.target == modal) {
                closeModal();
            }
            const zoneModal = document.getElementById('zoneModal');
            if (event.target == zoneModal) {
                closeZoneModal();
            }
        }

        // ============================================
        // ZONES DE LIVRAISON
        // ============================================

        function openCreateZoneModal() {
            document.getElementById('zoneModalTitle').textContent = 'Ajouter une zone de livraison';
            document.getElementById('zoneForm').reset();
            document.getElementById('ZoneLivraisonId').value = '';
            document.getElementById('EstActifZone').checked = true;
            document.getElementById('Supplement').value = '0';
            document.getElementById('zoneModal').style.display = 'block';
        }

        function openEditZoneModal(id) {
            document.getElementById('zoneModalTitle').textContent = 'Modifier la zone de livraison';
            document.getElementById('zoneForm').reset();
            
            fetch('@Url.Action("GetZoneLivraison", "Admin")?id=' + id)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        document.getElementById('ZoneLivraisonId').value = data.zone.ZoneLivraisonId;
                        document.getElementById('ZoneVille').value = data.zone.ZoneVille;
                        document.getElementById('Supplement').value = data.zone.Supplement;
                        document.getElementById('DelaiEstimeZone').value = data.zone.DelaiEstime || '';
                        document.getElementById('EstActifZone').checked = data.zone.EstActif;
                        document.getElementById('zoneModal').style.display = 'block';
                    } else {
                        alert('Erreur: ' + data.message);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Erreur lors du chargement des données');
                });
        }

        function closeZoneModal() {
            document.getElementById('zoneModal').style.display = 'none';
        }

        function saveZone(event) {
            event.preventDefault();
            
            const form = document.getElementById('zoneForm');
            const formData = new FormData(form);
            
            formData.set('EstActif', document.getElementById('EstActifZone').checked ? 'true' : 'false');

            const isEdit = formData.get('ZoneLivraisonId') !== '';
            const url = isEdit ? '@Url.Action("UpdateZoneLivraison", "Admin")' : '@Url.Action("CreateZoneLivraison", "Admin")';
            
            fetch(url, {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(result => {
                if (result.success) {
                    alert(result.message);
                    location.reload();
                } else {
                    alert('Erreur: ' + result.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Erreur lors de l\'enregistrement');
            });
        }

        function deleteZone(id) {
            if (confirm('Êtes-vous sûr de vouloir supprimer cette zone de livraison ?')) {
                fetch('@Url.Action("DeleteZoneLivraison", "Admin")?id=' + id, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                })
                .then(response => response.json())
                .then(result => {
                    if (result.success) {
                        alert(result.message);
                        location.reload();
                    } else {
                        alert('Erreur: ' + result.message);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Erreur lors de la suppression');
                });
            }
        }
    </script>
}
