@model E_Commerce_Cooperatives.Models.ViewModels.DashboardViewModel
@using E_Commerce_Cooperatives.Models.ViewModels
@{
    ViewBag.Title = "Tableau de bord";
    Layout = "~/Views/Admin/_AdminLayout.cshtml";
}

<div class="admin-page">
    <div class="admin-page-header">
        <h1 class="admin-page-title">Tableau de bord</h1>
        <p class="admin-page-subtitle">Vue d'ensemble de votre boutique</p>
    </div>

    <!-- Statistics Cards -->
    <div class="row mb-4">
        <div class="col-md-3 mb-3">
            <div class="dashboard-stat-card">
                <div class="stat-icon-wrapper" style="background-color: rgba(48, 92, 125, 0.1);">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="#305C7D" viewBox="0 0 16 16">
                        <path d="M0 2a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2zm15 2h-4v3h4V4zm0 4h-4v3h4V8zm0 4h-4v3h3a1 1 0 0 0 1-1v-2zm-5 3v-3H6v3h4zm-5 0v-3H1v2a1 1 0 0 0 1 1h3zm-4-4h4V8H1v3zm0-4h4V4H1v3zm5-3v3h4V4H6zm4 4H6v3h4V8z"/>
                    </svg>
                </div>
                <div class="stat-content-wrapper">
                    <div class="stat-trend positive">
                        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" viewBox="0 0 16 16">
                            <path fill-rule="evenodd" d="M8 12a.5.5 0 0 0 .5-.5V5.707l2.146 2.147a.5.5 0 0 0 .708-.708l-3-3a.5.5 0 0 0-.708 0l-3 3a.5.5 0 1 0 .708.708L7.5 5.707V11.5A.5.5 0 0 0 8 12z"/>
                        </svg>
                        <span>+@Model.SalesChangePercent%</span>
                    </div>
                    <h3 class="stat-value">@Model.TotalSales.ToString("N0") MAD</h3>
                    <p class="stat-label">Ventes totales</p>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="dashboard-stat-card">
                <div class="stat-icon-wrapper" style="background-color: rgba(192, 108, 80, 0.1);">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="#C06C50" viewBox="0 0 16 16">
                        <path d="M0 1.5A.5.5 0 0 1 .5 1H2a.5.5 0 0 1 .485.379L2.89 3H14.5a.5.5 0 0 1 .49.598l-1 5a.5.5 0 0 1-.465.401l-9.397.472L4.415 11H13a.5.5 0 0 1 0 1H4a.5.5 0 0 1-.491-.408L2.01 3.607 1.61 2H.5a.5.5 0 0 1-.5-.5zM3.102 4l.84 4.479 9.194-.459L13.89 4H3.102zM5 12a2 2 0 1 0 0 4 2 2 0 0 0 0-4zm7 0a2 2 0 1 0 0 4 2 2 0 0 0 0-4zm-7 1a1 1 0 1 1 0 2 1 1 0 0 1 0-2zm7 0a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"/>
                    </svg>
                </div>
                <div class="stat-content-wrapper">
                    <div class="stat-trend positive">
                        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" viewBox="0 0 16 16">
                            <path fill-rule="evenodd" d="M8 12a.5.5 0 0 0 .5-.5V5.707l2.146 2.147a.5.5 0 0 0 .708-.708l-3-3a.5.5 0 0 0-.708 0l-3 3a.5.5 0 1 0 .708.708L7.5 5.707V11.5A.5.5 0 0 0 8 12z"/>
                        </svg>
                        <span>+@Model.OrdersTodayChange</span>
                    </div>
                    <h3 class="stat-value">@Model.OrdersToday</h3>
                    <p class="stat-label">Commandes aujourd'hui</p>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="dashboard-stat-card">
                <div class="stat-icon-wrapper" style="background-color: rgba(125, 132, 83, 0.1);">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="#7D8453" viewBox="0 0 16 16">
                        <path d="M8.186 1.113a.5.5 0 0 0-.372 0L1.846 3.5 8 5.961 14.154 3.5 8.186 1.113zM15 4.239l-6.5 2.6v7.922l6.5-2.6V4.24zM7.5 14.762V6.838L1 4.239v7.923l6.5 2.6zM7.443.184a1.5 1.5 0 0 1 1.114 0l7.129 2.852A.5.5 0 0 1 16 3.5v8.662a1 1 0 0 1-.629.928l-7.185 2.874a.5.5 0 0 1-.372 0L.63 13.09a1 1 0 0 1-.63-.928V3.5a.5.5 0 0 1 .314-.464L7.443.184z"/>
                    </svg>
                </div>
                <div class="stat-content-wrapper">
                    <h3 class="stat-value">@Model.ActiveProducts</h3>
                    <p class="stat-label">Produits actifs</p>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="dashboard-stat-card">
                <div class="stat-icon-wrapper" style="background-color: rgba(48, 92, 125, 0.1);">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="#305C7D" viewBox="0 0 16 16">
                        <path d="M7 14s-1 0-1-1 1-4 5-4 5 3 5 4-1 1-1 1H7Zm4-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6Zm-5.784 6A2.238 2.238 0 0 1 5 13c0-1.355.68-2.75 1.936-3.72A6.325 6.325 0 0 0 5 9c-4 0-5 3-5 4s1 1 1 1h4.216Z"/>
                        <path d="M4.5 8a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5Z"/>
                    </svg>
                </div>
                <div class="stat-content-wrapper">
                    <div class="stat-trend positive">
                        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" viewBox="0 0 16 16">
                            <path fill-rule="evenodd" d="M8 12a.5.5 0 0 0 .5-.5V5.707l2.146 2.147a.5.5 0 0 0 .708-.708l-3-3a.5.5 0 0 0-.708 0l-3 3a.5.5 0 1 0 .708.708L7.5 5.707V11.5A.5.5 0 0 0 8 12z"/>
                        </svg>
                        <span>+@Model.UsersChange</span>
                    </div>
                    <h3 class="stat-value">@Model.TotalUsers</h3>
                    <p class="stat-label">Utilisateurs</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Alert Card -->
    @if (Model.RecentOrders.Any(o => o.Status == "Validée" || o.Status == "Préparation"))
    {
        var pendingCount = Model.RecentOrders.Count(o => o.Status == "Validée" || o.Status == "Préparation");
        <div class="row mb-4">
            <div class="col-12">
                <div class="dashboard-alert-card">
                    <div class="alert-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M0 1.5A.5.5 0 0 1 .5 1H2a.5.5 0 0 1 .485.379L2.89 3H14.5a.5.5 0 0 1 .49.598l-1 5a.5.5 0 0 1-.465.401l-9.397.472L4.415 11H13a.5.5 0 0 1 0 1H4a.5.5 0 0 1-.491-.408L2.01 3.607 1.61 2H.5a.5.5 0 0 1-.5-.5zM3.102 4l.84 4.479 9.194-.459L13.89 4H3.102zM5 12a2 2 0 1 0 0 4 2 2 0 0 0 0-4zm7 0a2 2 0 1 0 0 4 2 2 0 0 0 0-4zm-7 1a1 1 0 1 1 0 2 1 1 0 0 1 0-2zm7 0a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"/>
                        </svg>
                    </div>
                    <div class="alert-content">
                        <h4>@pendingCount commande(s) en attente</h4>
                        <p>Nécessitent votre attention</p>
                    </div>
                </div>
            </div>
        </div>
    }

    <!-- Main Content Cards -->
    <div class="row">
        <!-- Recent Orders Card -->
        <div class="col-md-6 mb-4">
            <div class="dashboard-content-card">
                <div class="card-header">
                    <h3 class="card-title">Commandes récentes</h3>
                    <a href="@Url.Action("Commandes", "Admin")" class="card-link">Voir tout</a>
                </div>
                <div class="card-body">
                    @if (Model.RecentOrders != null && Model.RecentOrders.Any())
                    {
                        foreach (var order in Model.RecentOrders)
                        {
                            <div class="order-item">
                                <div class="order-info">
                                    <div class="order-number">@order.OrderNumber</div>
                                    <div class="order-customer">@order.CustomerName</div>
                                </div>
                                <div class="order-amount">@order.Amount.ToString("N0") MAD</div>
                                <div class="order-status status-@order.Status.ToLower().Replace("é", "e").Replace("è", "e")">
                                    @order.Status
                                </div>
                            </div>
                        }
                    }
                    else
                    {
                        <p class="text-muted text-center py-3">Aucune commande récente</p>
                    }
                </div>
            </div>
        </div>

        <!-- Low Stock Card -->
        <div class="col-md-6 mb-4">
            <div class="dashboard-content-card">
                <div class="card-header">
                    <h3 class="card-title">Stock faible</h3>
                    <a href="@Url.Action("Produits", "Admin")" class="card-link">Gérer</a>
                </div>
                <div class="card-body">
                    @if (Model.LowStockProducts != null && Model.LowStockProducts.Any())
                    {
                        foreach (var product in Model.LowStockProducts)
                        {
                            <div class="stock-item">
                                <div class="stock-info">
                                    <div class="stock-name">@product.ProductName</div>
                                    <div class="stock-level">Stock: @product.Stock / Seuil: @product.AlertThreshold</div>
                                </div>
                            </div>
                        }
                    }
                    else
                    {
                        <p class="text-muted text-center py-3">Tous les produits ont un stock suffisant</p>
                    }
                </div>
            </div>
        </div>
    </div>

    <!-- Bottom Row Cards -->
    <div class="row">
        <!-- Best Selling Products -->
        <div class="col-md-6 mb-4">
            <div class="dashboard-content-card">
                <div class="card-header">
                    <h3 class="card-title">Produits les plus vendus</h3>
                </div>
                <div class="card-body">
                    @if (Model.BestSellingProducts != null && Model.BestSellingProducts.Any())
                    {
                        int rank = 1;
                        foreach (var product in Model.BestSellingProducts)
                        {
                            <div class="product-item">
                                <div class="product-rank">@rank</div>
                                <div class="product-info">
                                    <div class="product-name">@product.ProductName</div>
                                    <div class="product-sales">@product.SalesCount ventes</div>
                                </div>
                                <div class="product-price">@product.Price.ToString("N0") MAD</div>
                            </div>
                            rank++;
                        }
                    }
                    else
                    {
                        <p class="text-muted text-center py-3">Aucun produit vendu</p>
                    }
                </div>
            </div>
        </div>

        <!-- Cooperatives -->
        <div class="col-md-6 mb-4">
            <div class="dashboard-content-card">
                <div class="card-header">
                    <h3 class="card-title">Nos coopératives</h3>
                </div>
                <div class="card-body">
                    @if (Model.Cooperatives != null && Model.Cooperatives.Any())
                    {
                        foreach (var coop in Model.Cooperatives)
                        {
                            <div class="cooperative-item">
                                <div class="cooperative-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                                        <path d="M4 4a1 1 0 0 1 1-1h6a1 1 0 0 1 1v2a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1V4Zm1 3a1 1 0 0 1 1-1h1a1 1 0 0 1 1 1v5a1 1 0 0 1-1 1H6a1 1 0 0 1-1-1V7Zm4 0a1 1 0 0 1 1-1h1a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1a1 1 0 0 1-1-1V7Z"/>
                                        <path d="M3 0h10a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2v-1h1v1a1 1 0 0 0 1 1h10a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H3a1 1 0 0 0-1 1v1H1V2a2 2 0 0 1 2-2Z"/>
                                    </svg>
                                </div>
                                <div class="cooperative-info">
                                    <div class="cooperative-name">@coop.Name</div>
                                    <div class="cooperative-location">@coop.City</div>
                                </div>
                                <div class="cooperative-status">
                                    <span class="status-badge status-active">Active</span>
                                </div>
                            </div>
                        }
                    }
                    else
                    {
                        <p class="text-muted text-center py-3">Aucune coopérative</p>
                    }
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .dashboard-stat-card {
        background: white;
        border-radius: 12px;
        padding: 24px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        display: flex;
        align-items: center;
        gap: 16px;
        transition: transform 0.2s, box-shadow 0.2s;
    }

    .dashboard-stat-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.12);
    }

    .stat-icon-wrapper {
        width: 56px;
        height: 56px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
    }

    .stat-content-wrapper {
        flex: 1;
        position: relative;
    }

    .stat-trend {
        display: inline-flex;
        align-items: center;
        gap: 4px;
        font-size: 12px;
        font-weight: 600;
        margin-bottom: 8px;
    }

    .stat-trend.positive {
        color: #28a745;
    }

    .stat-trend.negative {
        color: #dc3545;
    }

    .stat-value {
        font-size: 28px;
        font-weight: 700;
        color: #305C7D;
        margin: 0 0 4px 0;
    }

    .stat-label {
        font-size: 14px;
        color: #6c757d;
        margin: 0;
    }

    .dashboard-alert-card {
        background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
        border-radius: 12px;
        padding: 20px 24px;
        display: flex;
        align-items: center;
        gap: 16px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }

    .alert-icon {
        width: 48px;
        height: 48px;
        background: rgba(255,255,255,0.8);
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #C06C50;
    }

    .alert-content h4 {
        margin: 0 0 4px 0;
        font-size: 18px;
        font-weight: 600;
        color: #856404;
    }

    .alert-content p {
        margin: 0;
        font-size: 14px;
        color: #856404;
        opacity: 0.8;
    }

    .dashboard-content-card {
        background: white;
        border-radius: 12px;
        padding: 24px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        height: 100%;
    }

    .card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 16px;
        border-bottom: 1px solid #e9ecef;
    }

    .card-title {
        font-size: 18px;
        font-weight: 600;
        color: #305C7D;
        margin: 0;
    }

    .card-link {
        color: #C06C50;
        text-decoration: none;
        font-size: 14px;
        font-weight: 500;
        transition: color 0.2s;
    }

    .card-link:hover {
        color: #a85a42;
        text-decoration: none;
    }

    .order-item {
        display: flex;
        align-items: center;
        gap: 16px;
        padding: 12px 0;
        border-bottom: 1px solid #f0f0f0;
    }

    .order-item:last-child {
        border-bottom: none;
    }

    .order-info {
        flex: 1;
    }

    .order-number {
        font-weight: 600;
        color: #305C7D;
        font-size: 14px;
        margin-bottom: 4px;
    }

    .order-customer {
        font-size: 13px;
        color: #6c757d;
    }

    .order-amount {
        font-weight: 600;
        color: #305C7D;
        font-size: 15px;
    }

    .order-status {
        padding: 4px 12px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 600;
    }

    .status-validee {
        background: #fff3cd;
        color: #856404;
    }

    .status-preparation {
        background: #ffeaa7;
        color: #856404;
    }

    .status-expediee {
        background: #ffd3a5;
        color: #c2410c;
    }

    .status-livree {
        background: #d4edda;
        color: #155724;
    }

    .stock-item {
        padding: 12px 0;
        border-bottom: 1px solid #f0f0f0;
    }

    .stock-item:last-child {
        border-bottom: none;
    }

    .stock-name {
        font-weight: 600;
        color: #305C7D;
        margin-bottom: 4px;
    }

    .stock-level {
        font-size: 13px;
        color: #6c757d;
    }

    .product-item {
        display: flex;
        align-items: center;
        gap: 16px;
        padding: 12px 0;
        border-bottom: 1px solid #f0f0f0;
    }

    .product-item:last-child {
        border-bottom: none;
    }

    .product-rank {
        width: 32px;
        height: 32px;
        background: #305C7D;
        color: white;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
        font-size: 14px;
        flex-shrink: 0;
    }

    .product-info {
        flex: 1;
    }

    .product-name {
        font-weight: 600;
        color: #305C7D;
        margin-bottom: 4px;
    }

    .product-sales {
        font-size: 13px;
        color: #6c757d;
    }

    .product-price {
        font-weight: 600;
        color: #305C7D;
        font-size: 15px;
    }

    .cooperative-item {
        display: flex;
        align-items: center;
        gap: 16px;
        padding: 12px 0;
        border-bottom: 1px solid #f0f0f0;
    }

    .cooperative-item:last-child {
        border-bottom: none;
    }

    .cooperative-icon {
        width: 40px;
        height: 40px;
        background: #f0f0f0;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #305C7D;
        flex-shrink: 0;
    }

    .cooperative-info {
        flex: 1;
    }

    .cooperative-name {
        font-weight: 600;
        color: #305C7D;
        margin-bottom: 4px;
    }

    .cooperative-location {
        font-size: 13px;
        color: #6c757d;
    }

    .status-badge {
        padding: 4px 12px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 600;
    }

    .status-active {
        background: #d4edda;
        color: #155724;
    }
</style>
